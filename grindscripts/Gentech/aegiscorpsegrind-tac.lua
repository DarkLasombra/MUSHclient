-- Define the steps for the grind path
steps = {
    -- Path to 5th Floor
    {"g", "pps", "tactical", "e", "s", "e", "e", "s", "s", "s", "e", "e", "n", "e", "n", "n", "n", "e", "kill robot"},
    {"g", "pps", "tactical", "d", "w", "w", "s", "w", "s", "w", "s", "s", "kill robot"},
    {"g", "pps", "tactical", "e", "d", "w", "w", "kill robot"},
    {"g", "pps", "tactical", "n", "n", "n", "e", "e", "e", "e", "n", "e", "d", "d", "e", "kill robot"},

    -- Fifth Floor
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "n", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "s", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "s", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "s", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "s", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "s", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "s", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "s", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "s", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "s", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"kill robot"},
    {"g", "pps", "tactical", "s", "kill robot"},
    {"kill robot"},

    -- Path back to first floor
    {"g", "pps", "tactical", "w", "w", "w", "w", "w", "w", "w", "w", "pry plate", "n", "n", "n", "nod", "s", "s", "s", "exit", "e", "e", "e", "e", "e", "n", "n", "n", "n", "n", "n", "n", "n", "e", "u", "u", "w", "s", "w", "w", "w", "w", "s", "s", "s", "e", "e", "u", "w", "n", "n", "e", "n", "e", "n", "e", "e", "u", "w", "s", "s", "s", "w", "s", "w", "w", "n", "n", "n", "w", "w", "n", "e", "kill robot"},
    
    -- First Floor
    {"g", "pps", "tactical", "s", "e", "e", "kill robot"},
    {"g", "pps", "tactical", "s", "w", "s", "w", "w", "n", "kill robot"},
    {"g", "pps", "tactical", "s", "e", "s", "kill robot"},
    {"g", "pps", "tactical", "e", "s", "e", "kill robot"},
    {"g", "pps", "tactical", "n", "e", "s", "e", "e", "n", "kill robot"},
    {"g", "pps", "tactical", "w", "s", "w", "n", "n", "e", "e", "kill robot"},
    {"g", "pps", "tactical", "n", "w", "n", "w", "kill robot"},
    {"g", "pps", "tactical", "n", "e", "e", "kill robot"},
    {"g", "pps", "tactical", "d", "s", "kill robot"},

    -- Second Floor
    {"g", "pps", "tactical", "n", "w", "n", "e", "kill robot"},
    {"g", "pps", "tactical", "w", "w", "kill robot"},
    {"g", "pps", "tactical", "s", "w", "w", "n", "kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"g", "pps", "tactical", "w", "w", "kill robot"},
    {"g", "pps", "tactical", "e", "s", "s", "kill robot"},
    {"g", "pps", "tactical", "w", "s", "kill robot"},
    {"g", "pps", "tactical", "e", "e", "kill robot"},
    {"g", "pps", "tactical", "w", "s", "kill robot"},
    {"g", "pps", "tactical", "s", "kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"g", "pps", "tactical", "s", "kill robot"},
    {"g", "pps", "tactical", "n", "n", "e", "kill robot"},
    {"g", "pps", "tactical", "e", "n", "kill robot"},
    {"g", "pps", "tactical", "e", "e", "e", "kill robot"},
    {"g", "pps", "tactical", "w", "s", "kill robot"},
    {"g", "pps", "tactical", "s", "kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"g", "pps", "tactical", "s", "w", "kill robot"},
    {"g", "pps", "tactical", "n", "kill robot"},
    {"g", "pps", "tactical", "w", "d", "w", "s", "kill robot"},
    
    -- Third Floor
    {"g", "pps", "tactical", "n", "w", "kill robot"},
    {"g", "pps", "tactical", "s", "kill robot"},
    {"g", "pps", "tactical", "n", "n", "n", "w", "s", "w", "kill robot"},
    {"g", "pps", "tactical", "e", "n", "w", "kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"g", "pps", "tactical", "e", "e", "n", "w", "kill robot"},
    {"g", "pps", "tactical", "e", "e", "n", "n", "w", "kill robot"},
    {"g", "pps", "tactical", "e", "e", "kill robot"},
    {"g", "pps", "tactical", "w", "s", "w", "kill robot"},
    {"g", "pps", "tactical", "e", "e", "kill robot"},
    {"g", "pps", "tactical", "w", "s", "e", "s", "kill robot"},
    {"g", "pps", "tactical", "n", "e", "s", "kill robot"},
    {"g", "pps", "tactical", "s", "kill robot"},
    {"g", "pps", "tactical", "n", "n", "e", "s", "kill robot"},
    {"g", "pps", "tactical", "n", "e", "s", "kill robot"},
    {"g", "pps", "tactical", "n", "e", "s", "s", "s", "s", "kill robot"},
    {"g", "pps", "tactical", "n", "w", "kill robot"},
    {"g", "pps", "tactical", "e", "e", "kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"g", "pps", "tactical", "w", "w", "n", "e", "kill robot"},
    {"g", "pps", "tactical", "w", "n", "e", "kill robot"},
    {"g", "pps", "tactical", "w", "n", "e", "kill robot"},
    {"g", "pps", "tactical", "w", "w", "n", "w", "kill robot"},
    {"g", "pps", "tactical", "e", "n", "kill robot"},
    {"g", "pps", "tactical", "s", "e", "e", "kill robot"},
    {"g", "pps", "tactical", "w", "d", "e", "n", "kill robot"},
    
    -- Fourth Floor
    {"g", "pps", "tactical", "w", "w", "w", "w", "w", "w", "kill robot"},
    {"g", "pps", "tactical", "w", "w", "kill robot"},
    {"g", "pps", "tactical", "s", "e", "kill robot"},
    {"g", "pps", "tactical", "e", "e", "e", "e", "e", "kill robot"},
    {"g", "pps", "tactical", "e", "e", "e", "kill robot"},
    {"g", "pps", "tactical", "s", "w", "kill robot"},
    {"g", "pps", "tactical", "w", "w", "w", "w", "kill robot"},
    {"g", "pps", "tactical", "w", "kill robot"},
    {"g", "pps", "tactical", "s", "kill robot"},
    {"g", "pps", "tactical", "e", "e", "e", "kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"g", "pps", "tactical", "e", "e", "s", "kill robot"},
    {"g", "pps", "tactical", "w", "w", "w", "w", "w", "kill robot"},
    {"g", "pps", "tactical", "w", "w", "w", "kill robot"},
    {"g", "pps", "tactical", "s", "e", "kill robot"},
    {"g", "pps", "tactical", "e", "e", "e", "kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"g", "pps", "tactical", "e", "e", "kill robot"},
    {"g", "pps", "tactical", "s", "w", "kill robot"},
    {"g", "pps", "tactical", "w", "w", "w", "w", "kill robot"},
    {"g", "pps", "tactical", "w", "w", "w", "kill robot"},
    {"g", "pps", "tactical", "s", "e", "e", "kill robot"},
    {"g", "pps", "tactical", "e", "e", "e", "e", "e", "e", "kill robot"},
    {"g", "pps", "tactical", "e", "kill robot"},
    {"g", "pps", "tactical", "s", "w", "w", "kill robot"},
    {"g", "pps", "tactical", "w", "w", "w", "kill robot"},
    {"g", "pps", "tactical", "w", "w", "w", "w", "kill robot"},
    {"g", "pps", "tactical", "s", "e", "kill robot"},
    {"g", "pps", "tactical", "e", "e", "kill robot"},
    {"g", "pps", "tactical", "e", "e", "e", "kill robot"},
    {"g", "pps", "tactical", "n", "n", "n", "n", "n", "n", "n", "n", "e", "u", "kill robot"}
    
}


-- Global variables
currentStepIndex = 0
aegisGrindActive = false
pauseGrind = false

-- Function to process the next step
function processNextStep()
    if not aegisGrindActive then
        ColourNote("red", "black", "Grind stopped.")
        return
    end

    -- Check if all steps are completed
    if currentStepIndex >= #steps then
        ColourNote("green", "black", "Aegis grind path completed!")
        aegisGrindActive = false
        return
    end

    -- Move to the next step
    currentStepIndex = currentStepIndex + 1
    local commands = steps[currentStepIndex]

    -- Send all commands for this step
    for _, command in ipairs(commands) do
        Send(command)
    end
end

-- Trigger: Recovery Finished (advances to next step)
function onRecovery(name, line, wildcards)
    if aegisGrindActive and not pauseGrind then
        processNextStep()
    end
end

-- Function to start the grind
function startGrind()
    if aegisGrindActive then
        ColourNote("yellow", "black", "Grind already in progress!")
        return
    end

    aegisGrindActive = true
    currentStepIndex = 0
    ColourNote("cyan", "black", "Starting Aegis grind...")
    processNextStep()
end

-- Function to stop the grind
function stopGrind()
    aegisGrindActive = false
    ColourNote("red", "black", "Grind stopped.")
end

-- Function to pause the grind
function pauseGrindFunction()
    pauseGrind = true
    ColourNote("yellow", "black", "Grind paused.")
end

-- Function to resume the grind
function resumeGrindFunction()
    if aegisGrindActive and pauseGrind then
        pauseGrind = false
        ColourNote("cyan", "black", "Resuming grind...")
        processNextStep()
    end
end